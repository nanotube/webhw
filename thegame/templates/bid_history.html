{% extends "base.html" %}
{% load filter_extras %}
{% load tag_extras %}

{% block title %}
Bid History for Auction for Asset {{ auction.asset.name }}
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="/">Home</a> &rsaquo; 
    <a href="{{ auction.asset.period.world.get_absolute_url }}">World</a> &rsaquo; 
    <a href="{{ auction.asset.period.get_absolute_url }}">Period</a> &rsaquo; 
    <a href="{{ auction.get_absolute_url }}">Auction</a> &rsaquo; 
    Bid History
</div>
{% endblock breadcrumbs %}

{% block content %}

{% if user_membership.is_master %}
    <div class="change_view">
        {% block change_view %}
            <a href="{{auction.get_absolute_url}}bid_history/master/" class="changelink">Master View</a>
        {% endblock change_view %}
    </div>
{% endif %}
<h2>Bid History for Auction for Asset <span class="name">{{ auction.asset.name }}</span></h2>

<ul>
    <li>Bids: {{ auction.bid_set.count }}</li>
    <li>Time left: 
        {% if not auction.is_ended %}
            {{ auction.get_current_end_time|timeuntil }}
        {% else %}
            Auction has ended.
        {% endif %}
    </li>
</ul>

<table class="site">
    <tr>
        <th>Bidder</th>
        <th>Bid amount</th>
        <th>Bid time</th>
    </tr>
        
    {% for bid in auction.bid_set.all %}
    <tr>
        <td class="left">
            {% block bidder_display %}
                {% ifequal user.id bid.bidder.id %}
                    {{ bid.bidder.username }}
                {% else %}
                    [hidden]
                {% endifequal %}
            {% endblock bidder_display %}
        </td>
        <td>
            {% block bid_amount_display %}
                {% ifequal user.id bid.bidder.id %}
                    {{ bid.amount|floatformat:2 }}
                {% else %}
                    {% if auction.is_ended %}
                        {{ bid.amount|floatformat:2 }}
                    {% else %}
                        [hidden]
                    {% endif %}
                {% endifequal %}
            {% endblock bid_amount_display %}
        </td>
        <td>{{ bid.time }}</td>
    </tr>
    {% empty %}
    <tr>
        <td>No bids.</td>
        <td></td>
        <td></td>
    </tr>
    {% endfor %}
        
    <tr>
        <td colspan="3" style="text-align: left;">
            <ul class="notes">
                <li>Highest bidder wins auction, at price equal to second highest bid amount.</li>
                <li>Multiple high bidders with the same bid amount share the asset evenly, at price equal to their bid amount.</li>
                <li>Names of bidders other than you are hidden.</li>
                <li>Bid amount are hidden until auction end.</li>
            </ul>
        </td>
    </tr>
</table>

<p><a href="{{ auction.get_absolute_url }}">[Back to auction]</a></p>

{% endblock %}
